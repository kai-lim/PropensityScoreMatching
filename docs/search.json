[
  {
    "objectID": "Notes.html",
    "href": "Notes.html",
    "title": "Notes",
    "section": "",
    "text": "Propensity score (PS) is the probability of receiving certain treatments, conditional on observed baseline covariates, and is estimated by using modeling to predict treatment allocation with covariates. In simple terms, PSA is based on the hypothesis that two patients with similar PSs have covariates which come from similar distributions. This means that by selecting or reweighting samples based on PS, researchers create new datasets where covariates are similar between treatment and control groups. For each individual, the propensity score can be intuitively considered as the probability of recentiving treatment, calcuated from a range of covariates (and potential confounders).\nWhen compared with conventional balancing methods, PS analysis has two major advantages: dimension reduction and design separation.\nI took an example from this R blogger post, where the research question was asked:\nIs smoking associated with psychological distress?\nEach smoker in the dataset will be matched to a non-smoker based on a range of covariates, e.g., sex, indigenous status, high school completion, marital status, region of residence, langauge background, age, and risky alcohol use.\nTwo steps were taken for propensity score matching:\n\nMatch each smoker to a non-smoker based on propensity score, which is calculated based on a range of covariates.\nCheck if balance between smokers (i.e., the treated or exposed group) and non-smokers (i.e., the control group) is achieved. We want both groups to have similar characteristics.\n\n\n\n\n\n\n\nNote\n\n\n\n\n\nThere are six steps in a complete analysis using propensity score matching:\n\nPreprocess data sets, identify outliers, and interpolate missing values.\nA model is specified, such as logistic regression, and trained on the dataset to predict whether a patient will be treated. For every patient, the trained model generates a probability of receiving treatment; i.e., his or her PS.\nMatching based on PS, where different matching methods are tried, such as nearest neighbor, or optimal or genetic matching\nThe balance of covariates between treatment and control groups is checked by calculating balance statistics and generating plots. A poor balance indicates that the model estimating PS needs to be respecified.\nThe treatment effects are estimated using matched data.\nSensitivity analyses are performed to check the robustness of study results for hidden bias\n\n\n\n\nWe will use data from this R blogger post.\n\n\n\nlibrary(tidyverse)\n\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.1\n✔ ggplot2   3.5.1     ✔ tibble    3.2.1\n✔ lubridate 1.9.3     ✔ tidyr     1.3.1\n✔ purrr     1.0.2     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n\nlibrary(MatchIt)\nlibrary(lmtest)\n\nLoading required package: zoo\n\nAttaching package: 'zoo'\n\nThe following objects are masked from 'package:base':\n\n    as.Date, as.Date.numeric\n\nlibrary(sandwich)\n\ndata <- read_csv(\"https://raw.githubusercontent.com/gckc123/ExampleData/main/smoking_psyc_distress.csv\")\n\nRows: 8000 Columns: 10\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\ndbl (10): sex, indigeneity, high_school, partnered, remoteness, language, sm...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n\nhead(data)\n\n# A tibble: 6 × 10\n    sex indigeneity high_school partnered remoteness language smoker\n  <dbl>       <dbl>       <dbl>     <dbl>      <dbl>    <dbl>  <dbl>\n1     0           0           1         1          0        1      0\n2     0           0           1         1          0        1      0\n3     0           0           0         0          0        1      0\n4     1           0           1         1          0        1      0\n5     0           0           0         1          1        1      0\n6     0           0           1         0          0        0      0\n# ℹ 3 more variables: risky_alcohol <dbl>, psyc_distress <dbl>, age <dbl>\n\n\nVariables of interest:\nSex (0: Female; 1: Male) indigenous - Ingigenous status (0: Non-indigenous; 1: indigenous) high_school - Education level (0: not finished high school; 1: finished high school) partnered - Marital status (0: not partnered; 1: partnered) remoteness - region of residence (0: major cities; 1: inner regional; 2: outer regional) language - Language background (0: non-English speaking; 1: English speaking) Smoker - Smoking status (0: non-smoker; 1: smoker) risky_alcohol - Risky alcohol use (0: not risky; 1: risky) psyc_distress - Psychological distress. Measure ranges from 10 to 50. age - Age of the participants\n\n\n\nMatchIt implements the suggestions of Ho et al. (2007) for improving parametric statistical models for estimating treatment effects in observational studies and reducing model dependence by preprocessing data with semi-parametric and non-parametric matching methods. After appropriately preprocessing with MatchIt, researchers can use whatever parametric model they would have used without MatchIt and produce inferences that are more robust and less sensitive to modeling assumptions. MatchIt reduces the dependence of causal inferences on commonly made, but hard-to-justify, statistical modeling assumptions using a large range of sophisticated matching methods. The package includes several popular approaches to matching and provides access to methods implemented in other packages through its single, unified, and easy-to-use interface.\n\n\n\n\n# Using the mathcit function from MatchIt to match each smoker with a non-smoker (1 to 1 matching) based on\n#sex, indigeneity status, high school completion, marital status (partnered or not),\n#region of residence (major cities, inner regional, outer regional), language background (English speaking Yes/No) \n#and risky alcohol drinking (Yes/No)\nmatch_obj <- matchit(smoker ~ sex + indigeneity + high_school + partnered + remoteness + language + risky_alcohol + age,\n  data = data, \n  method = \"nearest\", \n  distance =\"glm\",\n  ratio = 1,\n  replace = FALSE\n  )\nsummary(match_obj)\n\n\nCall:\nmatchit(formula = smoker ~ sex + indigeneity + high_school + \n    partnered + remoteness + language + risky_alcohol + age, \n    data = data, method = \"nearest\", distance = \"glm\", replace = FALSE, \n    ratio = 1)\n\nSummary of Balance for All Data:\n              Means Treated Means Control Std. Mean Diff. Var. Ratio eCDF Mean\ndistance             0.1850        0.1130          0.6310     2.0638    0.2035\nsex                  0.4938        0.4421          0.1035          .    0.0518\nindigeneity          0.0524        0.0175          0.1565          .    0.0349\nhigh_school          0.4220        0.6378         -0.4370          .    0.2158\npartnered            0.4630        0.6913         -0.4578          .    0.2283\nremoteness           0.6119        0.4553          0.1969     1.2318    0.0522\nlanguage             0.9579        0.9130          0.2234          .    0.0449\nrisky_alcohol        0.6427        0.5411          0.2120          .    0.1016\nage                 51.6057       53.7824         -0.1676     0.8214    0.0441\n              eCDF Max\ndistance        0.3204\nsex             0.0518\nindigeneity     0.0349\nhigh_school     0.2158\npartnered       0.2283\nremoteness      0.0921\nlanguage        0.0449\nrisky_alcohol   0.1016\nage             0.1020\n\nSummary of Balance for Matched Data:\n              Means Treated Means Control Std. Mean Diff. Var. Ratio eCDF Mean\ndistance             0.1850        0.1845          0.0042     1.0213    0.0002\nsex                  0.4938        0.4887          0.0103          .    0.0051\nindigeneity          0.0524        0.0390          0.0599          .    0.0133\nhigh_school          0.4220        0.4045          0.0353          .    0.0175\npartnered            0.4630        0.4713         -0.0165          .    0.0082\nremoteness           0.6119        0.6078          0.0052     1.0051    0.0014\nlanguage             0.9579        0.9671         -0.0460          .    0.0092\nrisky_alcohol        0.6427        0.6561         -0.0279          .    0.0133\nage                 51.6057       51.9723         -0.0282     0.9175    0.0145\n              eCDF Max Std. Pair Dist.\ndistance        0.0103          0.0053\nsex             0.0051          0.3019\nindigeneity     0.0133          0.2627\nhigh_school     0.0175          0.1767\npartnered       0.0082          0.1977\nremoteness      0.0021          0.3563\nlanguage        0.0092          0.0665\nrisky_alcohol   0.0133          0.1350\nage             0.0370          0.2881\n\nSample Sizes:\n          Control Treated\nAll          7026     974\nMatched       974     974\nUnmatched    6052       0\nDiscarded       0       0\n\n\n\n\n\n\nplot(match_obj, type = \"jitter\")\n\n\n\n\nTo identify the units, use first mouse button; to stop, use second.\n\nplot(match_obj, type = \"hist\")"
  }
]